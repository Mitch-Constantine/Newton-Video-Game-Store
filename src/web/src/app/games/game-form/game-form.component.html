@if (loadError()) {
  <div class="alert alert-danger">{{ loadError() }}</div>
}

@if (saveError()) {
  <div class="alert alert-danger">{{ saveError() }}</div>
}

<form [formGroup]="form" (ngSubmit)="submit()" class="container py-3">
  <div class="row mb-3">
    <label class="form-label col-md-2" for="game-barcode">Barcode</label>
    <div class="col-md-6">
      <input id="game-barcode" type="text" class="form-control" formControlName="barcode" />
      @if (form.get('barcode')?.invalid && form.get('barcode')?.touched) {
        <div class="text-danger small">Barcode is required and must not exceed 64 characters.</div>
      }
    </div>
  </div>
  <div class="row mb-3">
    <label class="form-label col-md-2" for="game-title">Title</label>
    <div class="col-md-6">
      <input id="game-title" type="text" class="form-control" formControlName="title" />
      @if (form.get('title')?.invalid && form.get('title')?.touched) {
        <div class="text-danger small">Title is required and must not exceed 200 characters.</div>
      }
    </div>
  </div>
  <div class="row mb-3">
    <label class="form-label col-md-2" for="game-description">Description</label>
    <div class="col-md-6">
      <textarea id="game-description" class="form-control" formControlName="description" rows="3"></textarea>
      @if (form.get('description')?.invalid && form.get('description')?.touched) {
        <div class="text-danger small">Description is required and must not exceed 2000 characters.</div>
      }
    </div>
  </div>
  <div class="row mb-3">
    <label class="form-label col-md-2" for="game-platform">Platform</label>
    <div class="col-md-4">
      <select id="game-platform" class="form-select" formControlName="platform">
        @for (p of platforms; track p) {
          <option [value]="p">{{ p }}</option>
        }
      </select>
    </div>
  </div>
  <div class="row mb-3">
    <label class="form-label col-md-2" for="game-status">Status</label>
    <div class="col-md-4">
      <select id="game-status" class="form-select" formControlName="status">
        @for (s of statuses; track s) {
          <option [value]="s">{{ s }}</option>
        }
      </select>
    </div>
  </div>
  <div class="row mb-3">
    <label class="form-label col-md-2" for="game-releaseDate">Release Date</label>
    <div class="col-md-4">
      <input id="game-releaseDate" type="date" class="form-control" formControlName="releaseDate" />
      @if (form.get('releaseDate')?.invalid && form.get('releaseDate')?.touched) {
        <div class="text-danger small">
          @if (form.get('releaseDate')?.errors?.['statusReleaseDate']) {
            {{ form.get('releaseDate')?.errors?.['statusReleaseDate'] }}
          } @else {
            Release date is required when Status is Upcoming or Active.
          }
        </div>
      }
    </div>
  </div>
  <div class="row mb-3">
    <label class="form-label col-md-2" for="game-price">Price</label>
    <div class="col-md-4">
      <input id="game-price" type="number" step="0.01" min="0.01" class="form-control" formControlName="price" />
      @if (form.get('price')?.invalid && form.get('price')?.touched) {
        <div class="text-danger small">Price must be greater than 0.</div>
      }
    </div>
  </div>
  <div class="row">
    <div class="offset-md-2 col-md-6 d-flex gap-2">
      <button type="submit" class="btn btn-primary" [disabled]="loading()">Save</button>
      @if (isEditMode) {
        <button type="button" class="btn btn-outline-secondary" (click)="reloadLatest()">Reload latest</button>
        <button type="button" class="btn btn-danger" (click)="deleteGame()" [disabled]="loading()">Delete</button>
      }
    </div>
  </div>
</form>
